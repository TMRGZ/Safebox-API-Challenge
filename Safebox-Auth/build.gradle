import org.openapitools.generator.gradle.plugin.tasks.GenerateTask

group 'com.rviewer.skeletons'
version '1.0.0'

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-jdbc'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.cloud:spring-cloud-stream-binder-rabbit:4.0.1'
    implementation 'io.jsonwebtoken:jjwt-impl:0.11.2'
    implementation 'io.jsonwebtoken:jjwt-jackson:0.11.2'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server'
    testImplementation 'org.awaitility:awaitility:4.2.0'
    testImplementation 'org.springframework.security:spring-security-test'
    testImplementation 'org.springframework.cloud:spring-cloud-stream-test-binder:4.0.1'

}

tasks.register('buildAuthServer', GenerateTask) {
    generatorName = "spring"
    inputSpec = "$rootDir/api/safebox-auth.spec.yaml"
    apiPackage = "com.rviewer.skeletons.infrastructure.controller"
    modelPackage = "com.rviewer.skeletons.application.model"
    modelNameSuffix = "Dto"
    outputDir = "$buildDir/generated/sources".toString()
    configOptions = [
            interfaceOnly        : "true",
            performBeanValidation: "true",
            useSpringBoot3       : "true"
    ]
}

tasks.compileJava.dependsOn(buildAuthServer)